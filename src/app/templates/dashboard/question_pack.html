<!DOCTYPE html>
<html>
{% include 'dashboard/head.html' %}
<body>
    <script src="{{ url_for('static', filename='js/question_pack.js') }}"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', _external=True, filename='css/question_style.css') }}">
    
    {% include 'logo.html' %}

    <!-- Variables for 'question_view' template -->
    {% set editable = True %}
    {% set stage = "QUESTION" %}

    <div id="question-pack-outer-wrapper">
        <div id="question-pack-wrapper">
            <div class="input-field">
                <label for="pack-name">Pack Name</label>
                <input id="question-pack-name" name="pack-name" type="text" value="{{ name }}" placeholder="Name of Pack" oninput="syncPackName(); dataChanged();">
            </div>

            <div class="input-field">
                <label for="pack-public" style="display: inline;">Public</label>
                <input id="question-pack-public" name="pack-public" type="checkbox"{% if public %} checked{% endif %} onchange="syncPackPublic(); dataChanged();">
            </div>

            <div class="input-field">
                <label for="pack-finale" style="display: inline;">Final Jeopardy</label>
                <input id="question-pack-finale" name="pack-finale" type="checkbox"{% if include_finale %} checked{% endif %} onchange="syncPackFinale(); dataChanged(); toggleFinale();">
            </div>

            <div class="input-field">
                <label for="language">Language</label>
                <select id="question-pack-language" name="language" onchange="syncPackLanguage(); dataChanged();">
                    {% if not language %}
                    {% set active_language = 'ENGLISH' %}
                    {% else %}
                    {% set active_language = language %}
                    {% endif %}

                    {% for language_id, language_name in languages %}
                    <option value="{{ language_id }}" {% if language_id == active_language %}selected{% endif %}>{{ language_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div id="question-pack-data-wrapper">
                <div id="question-pack-data-header">
                    <div>
                        {% for round_data in rounds -%}
                        {% if loop.last %}{% set round_name = "Finale" %}{% else %}{% set round_name = "Round " + loop.index | string %}{% endif %}
                        <button onclick="showRoundView({{ loop.index0 }});" class="question-pack-round-select-button question-pack-round-select-button-{{ loop.index0 }}{% if loop.last %} question-pack-round-select-finale{% if not include_finale %} d-none{% endif %}{% endif %}{% if loop.index == 1 %} question-pack-round-selected{% endif %}"><span>{{ round_name }}</span>{% if not loop.last %} <div onclick="deleteRound(event, {{ loop.index0 }})">&times;</div>{% endif %}</button>
                        {%- endfor -%}
                    </div>

                    <button class="question-pack-add-round-btn" onclick="addRound();">+</button>
                </div>

                <div id="question-pack-data-body">
                    {% for round_data in rounds %}
                    {% set round_num = loop.index0 %}
                    <div class="question-pack-round-wrapper question-pack-round-wrapper-{{ round_num }} d-none">
                        <div class="input-field">
                            <label for="round-name-{{ round_num }}">Round Name</label>
                            <input class="question-pack-round-name" name="round-name-{{ round_num }}" value="{{ round_data['name'] }}" onchange="syncRoundData({{ round_num }}); dataChanged();">
                        </div>

                        <div class="question-pack-round-body">
                            {% for category in round_data["categories"] %}
                            {% set category_num = loop.index0 %}
                            <div class="question-pack-category-wrapper question-pack-category-wrapper-{{ category_num }}">
                                <div class="question-pack-category-header">
                                    <button class="question-pack-delete-category-btn delete-button" onclick="deleteCategory(event, {{ round_num }}, {{ category_num }})">&times;</button>
                                    <input class="question-pack-category-name" value="{{ category['name'] }}" onchange="syncCategoryData({{ round_num }}, {{ category_num }}); dataChanged();">
                                </div>
            
                                <div class="question-pack-category-body">
                                    {% for question_data in category["questions"] %}
                                    <div class="question-pack-question-wrapper" onclick="showQuestionView({{ round_num }}, {{ category_num }}, {{ loop.index0 }})">
                                        <button class="question-pack-delete-question-btn delete-button" onclick="deleteQuestion(event, {{ round_num }}, {{ category_num }}, {{ loop.index0 }}); event.stopPropagation();">&times;</button>
                                        <input class="question-pack-question-name question-pack-question-name-{{ loop.index0 }}" value="{{ question_data['value'] }}" readonly>
                                    </div>

                                    {% set question = question_data["question"] %}
                                    {% set answer = question_data["answer"] %}
                                    {% set value = question_data["value"] %}
                                    {% set extra = question_data["extra"] %}

                                    <div class="question-pack-question-view question-pack-question-view-{{ loop.index0 }} d-none">
                                        <button class="question-pack-question-view-exit" onclick="saveQuestion({{ round_num }}, {{ category_num }}, {{ loop.index0 }});">&times;</button>
                                        {% include 'question_view.html' %}
                                    </div>

                                    {% endfor %}
                                </div>
                                <button class="question-pack-add-question-btn" onclick="createQuestionView({{ round_num }}, {{ category_num }})">+</button>
                            </div>
                            {% endfor -%}
                        </div>

                        <button class="question-pack-categories-placeholder{% if round_data['categories'] %} d-none{% endif %}" onclick="addCategory({{ round_num }});">Click here to add a category</button>

                        <button class="question-pack-add-category-btn{% if not round_data['categories'] %} d-none{% endif %}" onclick="addCategory({{ round_num }});">+</button>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <button id="question-pack-save-btn" class="default-button" disabled="true" onclick="saveData('{{ id }}');">
                <div class="save-btn-regular">Save</div>
                <div class="save-btn-pending d-none">
                    <div class="loading-icon"></div>
                </div>
                <div class="save-btn-success d-none">
                    <img src="{{ url_for('static', filename='img/success.png') }}">
                </div>
                <div class="save-btn-fail d-none">
                    <img src="{{ url_for('static', filename='img/error.png') }}">
                </div>
            </button>
        </div>
        
        <!-- Popup -->
        <div id="question-pack-popup" class="d-none"></div>
    </div>

    <!-- Question View Placeholder -->
    {% set category = {'name': 'Category Name', 'buzz_time': 10} %}
    {% set question = 'Question Goes Here' %}
    {% set answer = 'Answer Goes Here' %}
    {% set value = 100 %}
    {% set extra = {} %}
    <div class="question-pack-question-view question-pack-question-view-placeholder d-none">
        <button class="question-pack-question-view-exit">&times;</button>
        {% include 'question_view.html' %}
    </div>

    <script>
        {% for key in base_entries %}
        questionData["{{ key }}"] = {{ base_entries[key] | tojson }};
        {% endfor %}
        questionData['rounds'] = {{ rounds | tojson }};
        lastSaveState = JSON.stringify(questionData);
    </script>
</body>
</html>